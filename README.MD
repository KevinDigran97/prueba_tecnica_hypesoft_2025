# Sistema de Gerenciamento de Produtos Hypesoft

Sistema completo de gerenciamento de invent√°rio desenvolvido com arquitetura moderna, autentica√ß√£o via Keycloak e interface responsiva.

##  √çndice

- [Sobre o Projeto](#sobre-o-projeto)
- [Funcionalidades Implementadas](#funcionalidades-implementadas)
- [Tecnologias Utilizadas](#tecnologias-utilizadas)
- [Arquitetura](#arquitetura)
- [Configura√ß√£o e Instala√ß√£o](#configura√ß√£o-e-instala√ß√£o)
- [Dificuldades Encontradas](#dificuldades-encontradas)
- [Estrutura do Projeto](#estrutura-do-projeto)
- [API Endpoints](#api-endpoints)
- [Autentica√ß√£o e Autoriza√ß√£o](#autentica√ß√£o-e-autoriza√ß√£o)
- [Testes](#testes)

##  Sobre o Projeto

Sistema de gerenciamento de produtos desenvolvido como parte de um desafio t√©cnico. O projeto implementa um CRUD completo de produtos e categorias, com sistema de autentica√ß√£o robusto usando Keycloak, controle de acesso baseado em roles e interface moderna com Next.js.

##  Funcionalidades Implementadas

### Backend (.NET 9.0)

-  **CRUD Completo de Produtos**
  - Cria√ß√£o, leitura, atualiza√ß√£o e exclus√£o de produtos
  - Pagina√ß√£o de resultados
  - Busca por nome
  - Filtro por categoria
  - Identifica√ß√£o de produtos com estoque baixo (<10 unidades)

-  **CRUD Completo de Categorias**
  - Gerenciamento de categorias de produtos
  - Valida√ß√£o de exclus√£o (n√£o permite excluir categorias com produtos)
  - Listagem ordenada

-  **Dashboard com Estat√≠sticas**
  - Total de produtos no invent√°rio
  - Valor total do invent√°rio
  - Contagem de itens com estoque baixo
  - Distribui√ß√£o de produtos por categoria

-  **Autentica√ß√£o e Autoriza√ß√£o**
  - Integra√ß√£o com Keycloak
  - Autentica√ß√£o via JWT
  - Controle de acesso baseado em roles (Admin, Manager, User)
  - Refresh token

-  **Arquitetura Clean**
  - Separa√ß√£o em camadas (API, Application, Domain, Infrastructure)
  - CQRS com MediatR
  - Repository Pattern
  - Dependency Injection

-  **Valida√ß√µes**
  - FluentValidation para valida√ß√£o de comandos
  - Valida√ß√µes de dom√≠nio
  - Middleware de tratamento de exce√ß√µes global

-  **Logging**
  - Serilog configurado
  - Logs estruturados em arquivo e console
  - Logs detalhados de autentica√ß√£o

-  **Rate Limiting**
  - Prote√ß√£o contra abuso de API
  - Limita√ß√£o por IP

-  **MongoDB**
  - Persist√™ncia de dados
  - √çndices otimizados
  - Soft delete

-  **Health Checks**
  - Endpoint de verifica√ß√£o de sa√∫de da aplica√ß√£o

-  **Testes Unit√°rios**
  - Testes do Domain Layer
  - Testes do Application Layer
  - Cobertura de validadores

### Frontend (Next.js 16 + React 19)

-  **Dashboard Interativo**
  - Estat√≠sticas em tempo real
  - Gr√°ficos com Recharts
  - Cards informativos
  - Tabela de produtos com estoque baixo

-  **Gerenciamento de Produtos**
  - Listagem paginada com busca e filtros
  - Formul√°rio de cria√ß√£o/edi√ß√£o
  - Confirma√ß√£o de exclus√£o
  - Indicador visual de estoque baixo
  - Valida√ß√£o com Zod

-  **Gerenciamento de Categorias**
  - Grid responsivo de categorias
  - CRUD completo
  - Valida√ß√£o de depend√™ncias

-  **Autentica√ß√£o**
  - Login com Keycloak
  - Gest√£o de tokens (access + refresh)
  - Prote√ß√£o de rotas
  - Logout seguro
  - Interceptor axios para inje√ß√£o autom√°tica de token

-  **UI/UX Moderna**
  - Design system com shadcn/ui
  - Tailwind CSS
  - Tema dark/light
  - Componentes reutiliz√°veis
  - Responsivo (mobile-first)
  - Loading states
  - Toast notifications (sonner)

-  **Gest√£o de Estado**
  - React Query para cache e sincroniza√ß√£o
  - Zustand para estado global de autentica√ß√£o
  - Persist√™ncia de sess√£o

-  **TypeScript**
  - Tipagem forte em todo o c√≥digo
  - Interfaces compartilhadas
  - Type safety

## üõ†Ô∏è Tecnologias Utilizadas

### Backend

- **.NET 9.0** - Framework principal
- **ASP.NET Core** - API REST
- **MongoDB** - Banco de dados NoSQL
- **Keycloak** - Servidor de autentica√ß√£o
- **MediatR** - CQRS pattern
- **FluentValidation** - Valida√ß√µes
- **Serilog** - Logging
- **xUnit** - Testes unit√°rios
- **Moq** - Mocking para testes
- **FluentAssertions** - Assertions nos testes
- **Swashbuckle** - Documenta√ß√£o OpenAPI/Swagger

### Frontend

- **Next.js 16** - Framework React
- **React 19** - Biblioteca UI
- **TypeScript** - Tipagem est√°tica
- **Tailwind CSS** - Estiliza√ß√£o
- **shadcn/ui** - Componentes UI
- **React Query (TanStack Query)** - Data fetching
- **Zustand** - State management
- **React Hook Form** - Gerenciamento de formul√°rios
- **Zod** - Valida√ß√£o de schemas
- **Axios** - Cliente HTTP
- **Recharts** - Gr√°ficos
- **Lucide React** - √çcones
- **Sonner** - Toast notifications

### DevOps

- **Docker** - Containeriza√ß√£o
- **Docker Compose** - Orquestra√ß√£o
- **PostgreSQL** - Banco do Keycloak

##  Arquitetura

### Backend - Clean Architecture

```
backend/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ Hypesoft.API/          # Controllers, Middlewares
‚îÇ   ‚îú‚îÄ‚îÄ Hypesoft.Application/   # Use Cases, DTOs, Validators
‚îÇ   ‚îú‚îÄ‚îÄ Hypesoft.Domain/        # Entities, Interfaces
‚îÇ   ‚îî‚îÄ‚îÄ Hypesoft.Infrastructure/# Repositories, Data Context
‚îî‚îÄ‚îÄ tests/
    ‚îú‚îÄ‚îÄ Hypesoft.Domain.Tests/
    ‚îú‚îÄ‚îÄ Hypesoft.Application.Tests/
    ‚îî‚îÄ‚îÄ Hypesoft.API.Tests/
```

**Fluxo de Dados:**
```
Request ‚Üí Controller ‚Üí MediatR ‚Üí Handler ‚Üí Repository ‚Üí MongoDB
                                    ‚Üì
                              Validator
```

### Frontend - Feature-based

```
frontend/
‚îú‚îÄ‚îÄ app/                    # Pages e layouts
‚îÇ   ‚îú‚îÄ‚îÄ auth/login/        # P√°gina de login
‚îÇ   ‚îú‚îÄ‚îÄ dashboard/         # Dashboard e sub-p√°ginas
‚îÇ   ‚îú‚îÄ‚îÄ hooks/             # Custom hooks
‚îÇ   ‚îî‚îÄ‚îÄ types/             # TypeScript types
‚îú‚îÄ‚îÄ components/            # Componentes reutiliz√°veis
‚îÇ   ‚îú‚îÄ‚îÄ ui/               # Componentes base (shadcn)
‚îÇ   ‚îú‚îÄ‚îÄ dashboard/        # Componentes do dashboard
‚îÇ   ‚îú‚îÄ‚îÄ products/         # Componentes de produtos
‚îÇ   ‚îú‚îÄ‚îÄ categories/       # Componentes de categorias
‚îÇ   ‚îî‚îÄ‚îÄ layout/           # Layout components
‚îú‚îÄ‚îÄ lib/                  # Utilit√°rios e configura√ß√µes
‚îÇ   ‚îú‚îÄ‚îÄ api/             # Clientes API
‚îÇ   ‚îú‚îÄ‚îÄ auth.ts          # Configura√ß√£o NextAuth
‚îÇ   ‚îú‚îÄ‚îÄ keycloak.ts      # Integra√ß√£o Keycloak
‚îÇ   ‚îî‚îÄ‚îÄ utils.ts         # Fun√ß√µes auxiliares
‚îî‚îÄ‚îÄ store/               # Zustand stores
```

## üöÄ Configura√ß√£o e Instala√ß√£o

### Pr√©-requisitos

- Docker e Docker Compose
- .NET 9.0 SDK (para desenvolvimento local)
- Node.js 20+ (para desenvolvimento local)
- Git

### 1. Clone o Reposit√≥rio

```bash
git clone <repository-url>
cd Desafio-Tecnico-Hypesoft
```

### 2. Configura√ß√£o com Docker (Recomendado)

```bash
# Inicie todos os servi√ßos
docker-compose up -d

# Aguarde os servi√ßos iniciarem (pode levar 1-2 minutos)
docker-compose ps
```

Servi√ßos dispon√≠veis:
- **API Backend**: http://localhost:5000
- **Keycloak**: http://localhost:8080
- **MongoDB**: localhost:27017
- **MongoDB Express**: http://localhost:8081
- **PostgreSQL**: localhost:5432

### 3. Configura√ß√£o do Keycloak

Acesse http://localhost:8080 e fa√ßa login:
- **Usu√°rio**: admin
- **Senha**: admin

O Keycloak deve ser configurado manualmente ou via script. Credenciais de teste:
- **Admin**: admin / admin123 (roles: Admin, Manager, User)
- **Manager**: manager / manager123 (roles: Manager, User)
- **User**: user / user123 (role: User)

### 4. Acesse a Aplica√ß√£o

Frontend: Acesse http://localhost:3000 (se configurado)

Backend Swagger: http://localhost:5000/swagger

## ‚ö†Ô∏è Dificuldades Encontradas

### 1. Valida√ß√£o de JWT com Keycloak

**Problema Principal**: Durante a implementa√ß√£o da autentica√ß√£o JWT com Keycloak, enfrentei diversos desafios relacionados √† valida√ß√£o do token:

#### a) Mismatch de Audience (aud)

**Sintoma**: Token rejeitado com erro `InvalidAudience`

**Causa**: O Keycloak, por padr√£o, emite tokens com `aud: "account"`, mas a API esperava `aud: "hypesoft-api"`.

**Solu√ß√£o Implementada**:
```csharp
// Program.cs - Configura√ß√£o inicial (tempor√°ria)
options.TokenValidationParameters = new TokenValidationParameters
{
    ValidateAudience = false, // Desabilitado temporariamente
    // ... outras configura√ß√µes
};
```

**Solu√ß√£o Recomendada**: Configurar um Audience Mapper no Keycloak:
1. No cliente `hypesoft-api`: Adicionar mapper do tipo "Audience"
2. Incluir `hypesoft-api` como audience
3. Reativar valida√ß√£o: `ValidateAudience = true`

#### b) Issuer Configuration

**Sintoma**: Token rejeitado com erro `InvalidIssuer`

**Causa**: URL do issuer incorreta ou n√£o incluindo o caminho completo do realm.

**Solu√ß√£o**:
```csharp
// Authority deve incluir o realm
Authority = "http://localhost:8080/realms/hypesoft" // ‚úÖ Correto
// N√ÉO: "http://localhost:8080" // ‚ùå Incorreto
```

#### c) HTTPS Requirement em Desenvolvimento

**Sintoma**: Falha na valida√ß√£o por usar HTTP em vez de HTTPS

**Solu√ß√£o**:
```csharp
options.RequireHttpsMetadata = !isDevelopment; // false em dev, true em prod
```

#### d) Clock Skew

**Sintoma**: Tokens expirados rejeitados imediatamente ou aceitos ap√≥s expira√ß√£o

**Solu√ß√£o**:
```csharp
options.TokenValidationParameters = new TokenValidationParameters
{
    ClockSkew = TimeSpan.Zero // Sem margem de toler√¢ncia
};
```

### 2. Integra√ß√£o Frontend com Keycloak

**Problema**: Sincroniza√ß√£o entre Zustand, localStorage e o interceptor do Axios

**Solu√ß√£o**: Implementa√ß√£o de hidrata√ß√£o adequada do store e sincroniza√ß√£o manual:
```typescript
// auth-store.ts
onRehydrateStorage: () => (state) => {
  if (state?.accessToken) {
    localStorage.setItem('access_token', state.accessToken);
  }
  state.setHasHydrated(true);
}
```

### 3. Logging de Autentica√ß√£o

Para facilitar o debug, implementei logging detalhado:

```csharp
options.Events = new JwtBearerEvents
{
    OnAuthenticationFailed = context =>
    {
        Log.Error("Authentication failed: {ErrorType} - {ErrorMessage}", 
            context.Exception.GetType().Name, 
            context.Exception.Message);
        return Task.CompletedTask;
    },
    OnTokenValidated = context =>
    {
        Log.Information("Token validated successfully. User: {User}", 
            context.Principal?.Identity?.Name);
        return Task.CompletedTask;
    }
};
```

### 4. CORS Issues

**Problema**: Requisi√ß√µes bloqueadas por CORS em desenvolvimento

**Solu√ß√£o**:
```csharp
builder.Services.AddCors(options =>
{
    options.AddDefaultPolicy(builder =>
    {
        builder.AllowAnyOrigin()
               .AllowAnyMethod()
               .AllowAnyHeader();
    });
});
```

##  Estrutura do Projeto

### Backend - Camadas

**Domain Layer** (`Hypesoft.Domain`)
- Entidades de dom√≠nio (`Product`, `Category`)
- Interfaces de reposit√≥rios
- Exce√ß√µes de dom√≠nio
- L√≥gica de neg√≥cio

**Application Layer** (`Hypesoft.Application`)
- Commands e Queries (CQRS)
- Handlers (MediatR)
- DTOs
- Validators (FluentValidation)
- Interfaces de servi√ßos

**Infrastructure Layer** (`Hypesoft.Infrastructure`)
- Implementa√ß√£o de reposit√≥rios
- Contexto do MongoDB
- Configura√ß√µes de infraestrutura
- Repositories In-Memory (fallback)

**API Layer** (`Hypesoft.API`)
- Controllers
- Middlewares (ExceptionHandling, CorrelationId)
- Configura√ß√£o de autentica√ß√£o
- Startup configuration

##  API Endpoints

### Authentication
```
POST /api/auth/login - Login (Keycloak)
```

### Products
```
GET    /api/products              - Listar produtos (paginado)
GET    /api/products/{id}         - Obter produto por ID
GET    /api/products/low-stock    - Produtos com estoque baixo
POST   /api/products              - Criar produto [Admin, Manager]
PUT    /api/products/{id}         - Atualizar produto [Admin, Manager]
DELETE /api/products/{id}         - Excluir produto [Admin]
```

### Categories
```
GET    /api/categories            - Listar categorias
GET    /api/categories/{id}       - Obter categoria por ID
POST   /api/categories            - Criar categoria [Admin, Manager]
PUT    /api/categories/{id}       - Atualizar categoria [Admin, Manager]
DELETE /api/categories/{id}       - Excluir categoria [Admin]
```

### Dashboard
```
GET    /api/dashboard/stats       - Estat√≠sticas do dashboard
```

### Health
```
GET    /api/health                - Health check
```

##  Autentica√ß√£o e Autoriza√ß√£o

### Roles Implementadas

| Role    | Permiss√µes                                      |
|---------|------------------------------------------------|
| Admin   | Todas as opera√ß√µes (CRUD completo)            |
| Manager | Criar e editar produtos/categorias            |
| User    | Apenas visualiza√ß√£o                            |

### Fluxo de Autentica√ß√£o

1. **Login**: Frontend envia credenciais para Keycloak
2. **Token**: Keycloak retorna access_token e refresh_token
3. **Armazenamento**: Tokens salvos no Zustand + localStorage
4. **Requisi√ß√µes**: Axios interceptor injeta token no header
5. **Valida√ß√£o**: Backend valida JWT e extrai roles
6. **Autoriza√ß√£o**: Atributos `[Authorize(Roles = "...")]` protegem endpoints


Este projeto foi desenvolvido como parte de um desafio t√©cnico


